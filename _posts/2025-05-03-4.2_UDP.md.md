---
layout: post
title: L4-UDP
categories: 计算机网络
related_posts: True
tags:
toc:
  sidebar: left
---

## L4-UDP

![alt text](imgs/4.2_UDP_image.png)

#### 3.2 UDP

- **_UDP是什么？_**

  ​ UDP 在传送数据之前不需要先建立连接，远地主机在收到 UDP 报文后，不需要给出任何确认。虽然 UDP 不提供可靠交付，但在某些情况下 UDP 却是一种最有效的工作方式（一般用于即时通信），比如： QQ 语音、 QQ 视频 、直播等等

#### (4) UDP如何实现可靠传输

因为UDP是无连接的协议,所以在传输层上无法保证可靠传输,要想实现可靠传输,只能从应用层实现.需要实现seq/ack机制,重传机制和窗口确认机制.

就要接收方收到UDP之后回复个确认包,发送方有个机制,收不到确认包就要重新发送,每个包有递增的序号,接收方发现中间丢了包就要发重传请求,当网络太差时候频繁丢包,防止越丢包越重传的恶性循环,要有个发送窗口的限制,发送窗口的大小根据网络传输情况调整,调整算法要有一定自适应性.

#### 先来解释一下UDP

- UDP其实继承了IP包的属性 **不保证不丢失,不保证按顺序到达**<br>
- UDP继承了IP的特性, **基于数据报的,一个一个地发** 📦📦📦<br>
- UDP 我发,我发,我发发发. **who cares!**<br>
- UDP是一个 **无状态的服务**.<br>

## TCP和UDP的区别及适用场景

- 区别
  - **是否面向连接**
    - TCP是面向连接的,即发送数据前需要与目标主机建立连接
    - UDP面向无连接的,发送数据前不需要建立连接
  - 服务对象
    - TCP 是**一对一**的两点服务,即一条连接只有两个端点
    - UDP 支持**一对一/一对多/多对多的交互通信**
  - 传输方式
    - TCP 是**流式传输**,没有边界,但保证顺序和可靠
    - UDP 是一个包一个包的发送,是**有边界的**,但可能会**丢包和乱序**
  - **是否提供可靠交付**
    - TCP在传输数据之前,需要三次握手来建立连接,并且通过**数据校验/拥塞控制/重传控制/滑动窗口和确认应答**等机制来**实现可靠交付**.数据传输过程中,数据无丢失,无重复,无乱序
    - UDP**不提供可靠交付**,只有通过检验和去丢弃那些不完整的报文,尽最大努力来保证交付的可靠性
  - **分片不同**
    - TCP 的数据大小如果大于 MSS 大小,则会**在传输层进行分片**,目标主机收到后,也同样**在传输层组装 TCP 数据包**,如果中途丢失了一个分片,只需要传输丢失的这个分片
    - UDP 的数据大小如果大于 MTU 大小,则会**在 IP 层进行分片**,目标主机收到后,在 **IP 层组装完数据,接着再传给传输层**,但是**如果中途丢了一个分片,则就需要重传所有的数据包,这样传输效率非常差,所以通常 UDP 的报文应该小于 MTU**
  - 首部开销
    - TCP 首部长度较长,会有一定的开销,**首部在没有使用'选项'字段时是 20 个字节**,如果使用了'选项'字段则会变长的
    - UDP 首部只有 **8 个字节**,并且是**固定不变**的,开销较小
  - **工作效率**
    - 前面提到TCP传输数据的控制非常多,这也导致了TCP网络开销大,工作效率相对低下,对系统的资源要求也比较高
    - UDP传输控制简单,因此工作效率相对高,对系统资源的要求偏低
  - **实时性**
    - TCP传输数据的控制程序较多,大幅度降低了数据传输的实时性
    - UDP协议简单,数据实时性较高
  - **安全性**
    - TCP传输机制多,容易被利用,例如DOS/DDOS攻击,因此在安全性上,不如UDP
    - UDP没有TCP这么多机制,被利用的机会就会少很多,但UDP不是绝对安全,也会被攻击
- 适用场景
  - TCP
    - **对数据传输的质量有较高要求,但对实时性要求不高**.比如HTTP,HTTPS,FTP等传输文件的协议以及POP,SMTP等邮件传输的协议,应选用TCP协议
  - UDP
    - **只对数据传输的实时性要求较高,但不对传输质量有要求**.比如**视频传输/实时通信**等,应选用UDP协议

* 其实了解TCP协议，是为了全方位了解HTTP，包括其实际功能和局限性，之后才会更加深刻地理解为什么要推出HTTP/2，以及为什么要推出QUIC协议，也就是未来的HTTP/3。
