---
layout: post
title: （三）Qt 那些事儿：Qt的核心机制
categories: C++
related_posts: True
tags: Qt
toc:
  sidebar: right
---

### 1. introduction

Qt 的核心机制主要包含可屏蔽操作系统差异的事件处理机制，以及 Meta - Object Compiler（MOC，元对象编译器）机制。

事件处理机制能够屏蔽不同操作系统间的差异，让开发者可以统一处理各类事件，确保应用程序在不同平台上行为一致。前文已提及，此处不再赘述。

MOC 机制功能强大，涵盖信号与槽、动态属性以及反射等特性。信号与槽机制是一种强大的对象间通信方式，支持对象间以松耦合方式进行事件通知与响应；动态属性使开发者能够在运行时为对象添加属性，增强程序灵活性；反射则赋予程序在运行时获取对象类型信息、调用对象成员函数等能力。

除上述核心机制外，Qt 在各个模块中还包含一些重要机制：

- **控件管理**
  - **生命周期管理机制**：该机制从控件管理衍生而来，负责对象创建、销毁等生命周期过程，确保资源合理分配与释放，提升程序稳定性。
  - **控件布局管理机制**：用于合理规划控件在界面中的位置与大小，以适配不同屏幕尺寸和分辨率，增强用户界面的美观性与易用性。
  - **Model - View 分离机制**：将数据（Model）与用户界面（View）分离，使数据处理与显示相互独立，便于代码维护与扩展，同时提高代码复用性。
- **桌面应用软件相关机制**
  - **国际化与本地化机制**：助力应用程序满足不同地区和语言用户的需求，通过翻译文件等方式实现界面语言切换，以及日期、数字等格式的本地化显示。
  - **资源管理机制**：用于管理应用程序中的各类资源，如图片、图标、文本文件等，确保资源有效加载与使用，提高资源利用效率。
  - **插件管理机制**：允许开发者将应用程序部分功能以插件形式实现，方便功能扩展与定制，增强应用程序的扩展性。

### 99. quiz

#### 1. qt 中的 tr 的工作原理是什么?

在 Qt 中,tr 是一个用于国际化和本地化的函数.它的作用是将字符串进行翻译,以便在不同的语言环境下显示正确的文本.

tr 函数的工作原理如下:

1. 在代码中使用 tr 函数来标记需要翻译的字符串.例如:tr("Hello"). 在编译过程中,Qt 会将这些标记的字符串提取出来,并生成一个翻译文件(通常是一个.ts 文件).
2. 翻译人员会使用 Qt 提供的翻译工具,如 Qt Linguist,来翻译这些字符串,并将翻译结果保存在翻译文件中.
3. 在程序运行时,Qt 会根据当前的语言环境加载相应的翻译文件.

#### 3. 何时需使用 QSignalBlocker？

QSignalBlocker 在以下情形中颇具效用：

1. **状态修改但避免触发信号**：当需对对象状态进行修改，同时又不希望该修改触发任何信号时，可使用 QSignalBlocker。比如，更新 `QSpinBox` 的值，但不希望触发 `valueChanged` 信号。在此场景下，QSignalBlocker 可暂时阻断信号发射，确保状态修改过程不受信号处理逻辑干扰。
2. **批量操作后统一处理信号**：若要执行一系列操作，且这些操作可能触发多个信号，但期望仅在所有操作完成后再处理这些信号，QSignalBlocker 就派上用场了。例如，对 `QStandardItemModel` 的多个项进行修改，只希望在全部修改完成后再更新视图。利用 QSignalBlocker 可在操作期间抑制信号发射，待所有操作结束后，再让信号正常触发，从而实现对信号处理时机的精准控制。
3. **防止信号循环**：当存在两个相互关联的控件，一个控件状态改变会引发另一个控件状态改变，反之亦然时，为避免在特定时间段内产生循环信号，可使用 QSignalBlocker。比如，在修改其中一个控件状态时，通过 QSignalBlocker 阻止其发射信号，有效避免无限信号循环的产生。

需留意的是，QSignalBlocker 会阻断所有信号，包括可能期望处理的信号，所以应谨慎使用。若有可能，应通过优化代码设计，从根源上避免不必要的信号触发，而非过度依赖 QSignalBlocker。
