---
layout: post
title: L5-应用层
categories: 计算机网络
related_posts: True
tags:
toc:
  sidebar: left
---

## L5-应用层

- **_应用层有哪些?_**

  计算机网络的应用层有许多协议,常见的包括:

  - HTTP(超文本传输协议):用于在Web浏览器和Web服务器之间传输超文本文档.
  - FTP(文件传输协议):用于在客户端和服务器之间传输文件.
  - SMTP(简单邮件传输协议):用于在邮件客户端和邮件服务器之间传输电子邮件.
  - DNS(域名系统):用于将域名解析为IP地址.
  - SSH(安全外壳协议):用于在网络上安全地远程登录到远程计算机.
  - Telnet(远程终端协议):用于在网络上远程登录到远程计算机.
  - POP3(邮局协议版本3):用于从邮件服务器接收电子邮件.
  - IMAP(互联网消息访问协议):用于从邮件服务器接收和管理电子邮件.

### 应用层协议常用端口

|       应用       | 应用层协议 | 端口号  | 传输层协议 |            备注             |
| :--------------: | :--------: | :-----: | :--------: | :-------------------------: |
|     域名解析     |    DNS     |   53    |  UDP/TCP   | 长度超过 512 字节时使用 TCP |
| 动态主机配置协议 |    DHCP    |  67/68  |    UDP     |                             |
| 简单网络管理协议 |    SNMP    | 161/162 |    UDP     |                             |
|   文件传送协议   |    FTP     |  20/21  |    TCP     |   控制连接 21,数据连接 20   |
|   远程终端协议   |   TELNET   |   23    |    TCP     |                             |
|       ssh        |    ssh     |   22    |    TCP     |                             |
|  超文本传送协议  |    HTTP    |   80    |    TCP     |                             |
| 简单邮件传送协议 |    SMTP    |   25    |    TCP     |                             |
|   邮件读取协议   |    POP3    |   110   |    TCP     |                             |
| 网际报文存取协议 |    IMAP    |   143   |    TCP     |                             |

## token

- token 也称作令牌,其认证方式类似于**临时的证书签名**, 并且是一种**服务端无状态的认证方式**
- 组成
  - uid: 用户唯一身份标识
  - time: 当前时间的时间戳
  - sign: 签名, **使用 hash/encrypt 压缩成定长的十六进制字符串**,以防止第三方恶意拼接
  - 固定参数(可选): 将一些常用的固定参数加入到 token 中是为了避免重复查库
- 存放位置:**token在客户端一般存放于local Storage,cookie,或session Storage中**.**在服务器一般存于数据库中**
- token的认证过程(与cookie相似)
  - 用户登录,成功后服务器返回Token给客户端
  - 客户端收到数据后保存在客户端
  - 客户端再次访问服务器,将token放入headers中
  - 服务器端**采用filter过滤器校验**.校验成功则返回请求数据,校验失败则返回错误码
- **token可以抵抗csrf,cookie+session不行**

  - 假如用户正在登陆银行网页,同时登陆了攻击者的网页,并且银行网页未对csrf攻击进行防护.攻击者就可以在网页放一个表单,该表单提交src为`http://www.bank.com/api/transfer`,body为`count=1000&to=Tom`.倘若是session+cookie,用户打开网页的时候就已经转给Tom1000元了.**因为form 发起的 POST 请求并不受到浏览器同源策略的限制**,**因此可以任意地使用其他域的 Cookie 向其他域发送 POST 请求,形成 CSRF 攻击**.在post请求的瞬间,cookie会被浏览器自动添加到请求头中.**但token不同,token是开发者为了防范csrf而特别设计的令牌,浏览器不会自动添加到headers里,攻击者也无法访问用户的token,所以提交的表单无法通过服务器过滤,也就无法形成攻击**

- 分布式情况下的session和token

  - 我们已经知道session是有状态的,一般存于服务器内存或硬盘中,**当服务器采用分布式或集群时**,session就会面对负载均衡问题
    - **负载均衡多服务器的情况,不好确认当前用户是否登录,因为多服务器不共享session**.这个问题也可以将session存在一个服务器中来解决,但是就不能完全达到负载均衡的效果.当今的几种[解决session负载均衡](http://blog.51cto.com/zhibeiwang/1965018)的方法
  - 而token是无状态的,token字符串里就保存了所有的用户信息
    - 客户端登陆传递信息给服务端,服务端收到后把**用户信息加密(token)传给客户端**,客户端将token存放于local Storage等容器中.客户端每次访问都传递token,服务端解密token,就知道这个用户是谁了.**通过cpu加解密,服务端就不需要存储session占用存储空间,就很好的解决负载均衡多服务器的问题了**.这个方法叫做JWT(Json Web Token)

- 总结

  - session存储于服务器,可以理解为一个状态列表,拥有一个唯一识别符号session Id,**通常存放于cookie中**.**服务器收到cookie后解析出session Id,再去session列表中查找,才能找到相应session**.依赖cookie
  - **cookie类似一个令牌,装有session Id,存储在客户端,浏览器通常会自动添加**
  - **token也类似一个令牌,无状态,用户信息都被加密到token中,服务器收到token后解密就可知道是哪个用户**.需要开发者手动添加
  - jwt只是一个跨域认证的方案
