---
layout: post
title: 内存运行的基本原理
categories: 计算机系统
related_posts: True
tags: 内存
toc:
  sidebar: left
---

## 内存运行的基本原理

- 内存工作原理

  - 内存通过数据总线、地址总线和控制总线与计算机的其他部件（如CPU、硬盘等）进行通信。数据总线用于传输数据，地址总线用于指定要访问的存储单元的地址，控制总线用于传输控制信号，以协调内存与其他部件之间的操作。总之，cpu和内存之间可以传输数据
  - 当cpu发送读内存请求的时候，会通过总线将地址和长度传到内存的控制器，内存控制器会根据地址和长度从对应的存储块读取数值，并通过总线将数据返回。

- 存储单元
  - 内存由许多存储单元组成，每个存储单元都有一个唯一的地址，就像房子有门牌号一样。这些存储单元可以存储一定量的数据，通常是8位、16位、32位或64位等，常见的是8位，即一个字节（Byte）。
  - 具体来说，内存中的存储单元是由晶体管和电容等电子元件组成的。以动态随机存取存储器（DRAM）为例，电容用于存储电荷，当电容充电时，表示存储的值为1；当电容放电时，表示存储的值为0。由于电容会逐渐漏电，所以DRAM需要定期进行刷新操作，以保持数据的正确性。
  - 另一种常见的内存是静态随机存取存储器（SRAM），它使用触发器来存储数据。触发器是一种能够存储二进制信息的电路，只要有电源供应，它就能够保持存储的数据，不需要像DRAM那样定期刷新。不过，SRAM的成本较高、集成度较低，通常用于高速缓存（Cache）等对速度要求较高的场景。

### 1. 内存的作用

- **为什么要有内存？**
  程序的运行在内存上。
  CPU 的处理速度远远快于磁盘，内存的主要作用是缓解 CPU 与硬盘之间的速度矛盾。如果没有内存，CPU 将不得不等待磁盘传输数据，这会浪费 CPU 的性能。

- **程序的本质**：

  - 程序是指挥计算机运行和操作的一系列指令的集合，它包含命令段（指令序列）和数据段（存储程序运行所需的数据）。这些命令和数据本质上都是存储在存储介质中的信息。
  - 程序中的命令段负责完成各种操作，如算术运算、逻辑判断、流程控制等，而数据段存储着程序运行过程中需要使用的变量、常量、数组等数据。

- **为什么内存比硬盘快？**
  内存的速度之所以比硬盘快，是因为它们的存储原理和读取方式不同。硬盘是机械结构，通过磁头的转动读取数据，而内存是通过电存取数据的。
  - 硬盘和内存作为不同的存储介质，具有显著差异。硬盘是基于磁性或固态存储技术，具有大容量但读写速度慢，适合长期存储大量数据；而内存是基于半导体存储技术，读写速度快，但容量相对较小且断电后数据丢失。
  - 它们之间可以看作是一种存储容量、价格和 I/O 速度的权衡。硬盘的存储成本低但速度慢，适合存储不常访问的数据，而内存速度快但成本高，用于存储当前正在运行程序所需的指令和数据。

### 2. 操作系统需要为内存提供什么能力？

- 操作系统需要为内存提供这些机制：

  - 内存的装入和链接：
    程序从硬盘到内存的过程，其中装入包括绝对装入（编译时已知程序在内存中的位置，按绝对地址装入）、可重定位装入（将逻辑地址在装入时转换为物理地址）、动态装入（将逻辑地址的转换推迟到程序执行时）等；链接包括静态链接（在程序运行前完成所有链接）、动态链接（包括装入时动态链接和运行时动态链接）等。

  - 内存分配与管理：
    内存如何分配、回收，包括连续分配（如单一连续分配，将内存分为系统区和用户区，仅适用于单用户/单任务系统；固定分区分配，将用户空间划分为固定大小的分区；动态分区分配，根据进程大小动态建立分区）和非连续分配（如分页，将内存和进程空间划分为相等的页和页框；分段，将地址空间按程序逻辑关系划分为段；段页式，结合分段和分页）等。

  - 内存交换与虚拟内存：通过将磁盘空间作为物理内存的扩展，为程序提供比实际物理内存更大的虚拟地址空间，解决物理内存不足的问题。

  - 高级功能与优化：
    - 内存保护：防止进程之间以及进程与操作系统之间的非法内存访问，确保系统的稳定性和安全性，通常通过硬件和软件结合实现。
    - 高速缓存管理：利用高速缓存（Cache）来提高内存访问速度，减少 CPU 等待时间，包括多级缓存结构（如 L1、L2、L3 缓存）和缓存替换策略（如 LRU、FIFO 等）。
    - 内存碎片整理：解决内存中出现的碎片问题，提高内存的利用率，包括内部碎片（如分页时页内未使用部分）和外部碎片（如动态分区分配产生的小空闲分区），可采用紧凑技术等。
    - 共享内存：允许多个进程共享部分内存，以实现进程间的数据共享和通信，提高系统资源的利用率。
    - 内存映射：将文件映射到内存，提高文件的访问效率，可用于大文件操作和进程间通信等。

- **小结**
  - 程序的本质上是存储介质的信息，是指挥计算机运行和操作的一系列指令的集合；
  - 内存存在的意义是因为 cpu 速度和硬盘（存储介质）的速度不匹配；
